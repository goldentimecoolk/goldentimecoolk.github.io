<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="Caffe has command line, Python, and MATLAB interfaces for day-to-day usage, interfacing with research code, and rapid prototyping. While Caffe is a C++ library at heart and it exposes a modular interf">
<meta property="og:type" content="article">
<meta property="og:title" content="【caffe】interface">
<meta property="og:url" content="http://yoursite.com/2018/08/06/2018-06-06-【caffe】interface/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Caffe has command line, Python, and MATLAB interfaces for day-to-day usage, interfacing with research code, and rapid prototyping. While Caffe is a C++ library at heart and it exposes a modular interf">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2018-08-06T09:01:47.458Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="【caffe】interface">
<meta name="twitter:description" content="Caffe has command line, Python, and MATLAB interfaces for day-to-day usage, interfacing with research code, and rapid prototyping. While Caffe is a C++ library at heart and it exposes a modular interf">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/08/06/2018-06-06-【caffe】interface/"/>





  <title>【caffe】interface | Hexo</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/06/2018-06-06-【caffe】interface/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Sky">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">【caffe】interface</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-06T17:01:47+08:00">
                2018-08-06
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2018-08-06T17:01:47+08:00">
                2018-08-06
              </time>
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/06/2018-06-06-【caffe】interface/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count gitment-comments-count" data-xid="/2018/08/06/2018-06-06-【caffe】interface/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>Caffe has command line, Python, and MATLAB interfaces for day-to-day usage, interfacing with research code, and rapid prototyping. While Caffe is a C++ library at heart and it exposes a modular interface for development, not every occasion calls for custom compilation. The <strong>cmdcaffe, pycaffe, and matcaffe interfaces</strong> are here for you. <em>虽然Caffe是一个C ++库，并且它提供了一个用于开发的模块化接口，但并非每次都需要自定义编译。</em></p>
<h3 id="Command-Line"><a href="#Command-Line" class="headerlink" title="Command Line"></a>Command Line</h3><hr>
<p>The command line interface – cmdcaffe – is the caffe tool for model training, scoring, and diagnostics. Run caffe without any arguments for help. This tool and others are found in caffe/build/tools. (The following example calls require completing the LeNet / MNIST example first.)</p>
<p><strong>Training:</strong> <code>caffe train</code> learns models from scratch, resumes learning from saved snapshots, and fine-tunes models to new data and tasks:</p>
<ul>
<li><p>All training requires a solver configuration through the -solver solver.prototxt argument.</p>
</li>
<li><p>Resuming requires the -snapshot model_iter_1000.solverstate argument to load the solver snapshot.</p>
</li>
<li><p>Fine-tuning requires the -weights model.caffemodel argument for the model initialization.</p>
</li>
</ul>
<p>For example, you can run:</p>
<pre><code># train LeNet
caffe train -solver examples/mnist/lenet_solver.prototxt
# train on GPU 2
caffe train -solver examples/mnist/lenet_solver.prototxt -gpu 2
# resume training from the half-way point snapshot
caffe train -solver examples/mnist/lenet_solver.prototxt -snapshot examples/mnist/lenet_iter_5000.solverstate
</code></pre><p>For a full example of fine-tuning, see examples/finetuning_on_flickr_style, but the training call alone is</p>
<pre><code># fine-tune CaffeNet model weights for style recognition
caffe train -solver examples/finetuning_on_flickr_style/solver.prototxt -weights models/bvlc_reference_caffenet/bvlc_reference_caffenet.caffemodel
</code></pre><p><strong>Testing:</strong> <code>caffe test</code> scores models by running them in the test phase and reports the net output as its score. The net architecture must be properly defined to output an accuracy measure or loss as its output. The per-batch score is reported and then the grand average is reported last.</p>
<pre><code># score the learned LeNet model on the validation set as defined in the
# model architeture lenet_train_test.prototxt
caffe test -model examples/mnist/lenet_train_test.prototxt -weights examples/mnist/lenet_iter_10000.caffemodel -gpu 0 -iterations 100
</code></pre><p><strong>Benchmarking:</strong> <code>caffe time</code> benchmarks model execution layer-by-layer through timing and synchronization. This is useful to check system performance and measure relative execution times for models.</p>
<pre><code># (These example calls require you complete the LeNet / MNIST example first.)
# time LeNet training on CPU for 10 iterations
caffe time -model examples/mnist/lenet_train_test.prototxt -iterations 10
# time LeNet training on GPU for the default 50 iterations
caffe time -model examples/mnist/lenet_train_test.prototxt -gpu 0
# time a model architecture with the given weights on the first GPU for 10 iterations
caffe time -model examples/mnist/lenet_train_test.prototxt -weights examples/mnist/lenet_iter_10000.caffemodel -gpu 0 -iterations 10
</code></pre><p><strong>Diagnostics:</strong> <code>caffe device_query</code> reports GPU details for reference and checking device ordinals for running on a given device in multi-GPU machines.</p>
<pre><code># query the first device
caffe device_query -gpu 0
</code></pre><p><strong>Parallelism:</strong> the -gpu flag to the caffe tool can take a comma separated list of IDs to run on multiple GPUs. A solver and net will be instantiated for each GPU so the batch size is effectively multiplied by the number of GPUs. To reproduce single GPU training, reduce the batch size in the network definition accordingly.</p>
<pre><code># train on GPUs 0 &amp; 1 (doubling the batch size)
caffe train -solver examples/mnist/lenet_solver.prototxt -gpu 0,1
# train on all GPUs (multiplying batch size by number of devices)
caffe train -solver examples/mnist/lenet_solver.prototxt -gpu all
</code></pre><h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><hr>
<p>The Python interface – pycaffe – is the caffe module and its scripts in caffe/python. <code>import caffe</code> to load models, do forward and backward, handle IO, visualize networks, and even instrument model solving. All model data, derivatives, and parameters are exposed for reading and writing.</p>
<ul>
<li>caffe.Net is the central interface for loading, configuring, and running models. </li>
<li>caffe.Classifier and caffe.Detector provide convenience interfaces for common tasks.</li>
<li>caffe.SGDSolver exposes the solving interface.</li>
<li>caffe.io handles input / output with preprocessing and protocol buffers.</li>
<li>caffe.draw visualizes network architectures.</li>
<li>Caffe blobs are exposed as numpy ndarrays for ease-of-use and efficiency.</li>
</ul>
<p>Tutorial IPython notebooks are found in caffe/examples: do ipython notebook <code>caffe/examples</code> to try them. For developer reference docstrings can be found throughout the code.</p>
<p>Compile pycaffe by make pycaffe. Add the module directory to your <code>$PYTHONPATH</code> by export <code>PYTHONPATH=/path/to/caffe/python:$PYTHONPATH</code> or the like for import caffe.</p>
<h3 id="MATLAB"><a href="#MATLAB" class="headerlink" title="MATLAB"></a>MATLAB</h3><hr>
<p>The MATLAB interface <strong>matcaffe</strong> is the caffe package in caffe/matlab in which you can integrate Caffe in your Matlab code.</p>
<p>In MatCaffe, you can</p>
<ul>
<li>Creating multiple Nets in Matlab</li>
<li>Do forward and backward computation</li>
<li>Access any layer within a network, and any parameter blob in a layer</li>
<li>Get and set data or diff to any blob within a network, not restricting to input blobs or output blobs</li>
<li>Save a network’s parameters to file, and load parameters from file</li>
<li>Reshape a blob and reshape a network</li>
<li>Edit network parameter and do network surgery</li>
<li>Create multiple Solvers in Matlab for training</li>
<li>Resume training from solver snapshots</li>
<li>Access train net and test nets in a solver</li>
<li>Run for a certain number of iterations and give back control to Matlab</li>
<li>Intermingle arbitrary Matlab code with gradient steps</li>
</ul>
<p>An ILSVRC image classification demo is in caffe/matlab/demo/classification_demo.m (you need to download BAIR CaffeNet from <a href="http://caffe.berkeleyvision.org/model_zoo.html" target="_blank" rel="noopener">Model Zoo</a> to run it).</p>
<h4 id="Build-MatCaffe"><a href="#Build-MatCaffe" class="headerlink" title="Build MatCaffe"></a>Build MatCaffe</h4><hr>
<p>Build MatCaffe with <code>make all matcaffe</code>. After that, you may test it using <code>make mattest</code>.</p>
<p>Common issue: if you run into error messages like libstdc++.so.6:version ‘GLIBCXX_3.4.15’ not found during make mattest, then it usually means that your Matlab’s runtime libraries do not match your compile-time libraries. You may need to do the following before you start Matlab:</p>
<pre><code>export LD_LIBRARY_PATH=/opt/intel/mkl/lib/intel64:/usr/local/cuda/lib64
export LD_PRELOAD=/usr/lib/x86_64-linux-gnu/libstdc++.so.6
</code></pre><p>Or the equivalent based on where things are installed on your system, and do <code>make mattest</code> again to see if the issue is fixed. </p>
<p>Note: this issue is sometimes more complicated since during its startup Matlab may overwrite your <code>LD_LIBRARY_PATH</code> environment variable. You can run <code>!ldd ./matlab/+caffe/private/caffe_.mexa64</code> (the mex extension may differ on your system) in Matlab to see its runtime libraries, and preload your compile-time libraries by exporting them to your <code>LD_PRELOAD</code> environment variable.</p>
<p>After successful building and testing, <u>add this package to Matlab search PATH by starting matlab from caffe root folder</u> and running the following commands in Matlab command window.</p>
<pre><code>addpath ./matlab
</code></pre><p>You can save your Matlab search PATH by running <code>savepath</code> so that you don’t have to run the command above again every time you use MatCaffe.</p>
<h4 id="Use-MatCaffe"><a href="#Use-MatCaffe" class="headerlink" title="Use MatCaffe"></a>Use MatCaffe</h4><hr>
<p>MatCaffe is very similar to PyCaffe in usage.</p>
<p>Examples below shows detailed usages and assumes you have downloaded BAIR CaffeNet from <a href="http://caffe.berkeleyvision.org/model_zoo.html" target="_blank" rel="noopener">Model Zoo</a> and started matlab from caffe root folder.</p>
<pre><code>model = &apos;./models/bvlc_reference_caffenet/deploy.prototxt&apos;;
weights = &apos;./models/bvlc_reference_caffenet/bvlc_reference_caffenet.caffemodel&apos;;
</code></pre><h5 id="Set-mode-and-device"><a href="#Set-mode-and-device" class="headerlink" title="Set mode and device"></a>Set mode and device</h5><p>Mode and device should always be set BEFORE you create a net or a solver.</p>
<p>Use CPU:</p>
<pre><code>caffe.set_mode_cpu();
</code></pre><p>Use GPU and specify its gpu_id:</p>
<pre><code>caffe.set_mode_gpu();
caffe.set_device(gpu_id);
</code></pre><h5 id="Create-a-network-and-access-its-layers-and-blobs"><a href="#Create-a-network-and-access-its-layers-and-blobs" class="headerlink" title="Create a network and access its layers and blobs"></a>Create a network and access its layers and blobs</h5><p>Create a network:</p>
<pre><code>net = caffe.Net(model, weights, &apos;test&apos;); % create net and load weights
</code></pre><p>Or</p>
<pre><code>net = caffe.Net(model, &apos;test&apos;); % create net but not load weights
net.copy_from(weights); % load weights
</code></pre><p>which creates net object as</p>
<pre><code>Net with properties:

         layer_vec: [1x23 caffe.Layer]
          blob_vec: [1x15 caffe.Blob]
            inputs: {&apos;data&apos;}
           outputs: {&apos;prob&apos;}
  name2layer_index: [23x1 containers.Map]
   name2blob_index: [15x1 containers.Map]
       layer_names: {23x1 cell}
        blob_names: {15x1 cell}
</code></pre><p>The two containers.Map objects are useful to find <u>the index of a layer or a blob by its name</u>.</p>
<p>You have access to every blob in this network. To fill blob ‘data’ with all ones:</p>
<pre><code>net.blobs(&apos;data&apos;).set_data(ones(net.blobs(&apos;data&apos;).shape));
</code></pre><p>To multiply all values in blob ‘data’ by 10:</p>
<pre><code>net.blobs(&apos;data&apos;).set_data(net.blobs(&apos;data&apos;).get_data() * 10);
</code></pre><p><strong>Be aware that since Matlab is 1-indexed and column-major, the usual 4 blob dimensions in Matlab are [width, height, channels, num], and width is the fastest dimension. Also be aware that images are in BGR channels.</strong> Also, Caffe uses single-precision float data. If your data is not single, <code>set_data</code> will automatically convert it to single.</p>
<p>You also have access to every layer, so you can do network surgery. For example, to multiply conv1 parameters by 10:</p>
<pre><code>net.params(&apos;conv1&apos;, 1).set_data(net.params(&apos;conv1&apos;, 1).get_data() * 10); % set weights
net.params(&apos;conv1&apos;, 2).set_data(net.params(&apos;conv1&apos;, 2).get_data() * 10); % set bias
</code></pre><p>Alternatively, you can use</p>
<pre><code>net.layers(&apos;conv1&apos;).params(1).set_data(net.layers(&apos;conv1&apos;).params(1).get_data() * 10);
net.layers(&apos;conv1&apos;).params(2).set_data(net.layers(&apos;conv1&apos;).params(2).get_data() * 10);
</code></pre><p>To save the network you just modified:</p>
<pre><code>net.save(&apos;my_net.caffemodel&apos;);
</code></pre><p>To get a layer’s type (string):</p>
<pre><code>layer_type = net.layers(&apos;conv1&apos;).type;
</code></pre><h5 id="Forward-and-backward"><a href="#Forward-and-backward" class="headerlink" title="Forward and backward"></a>Forward and backward</h5><p>Forward pass can be done using <code>net.forward</code> or <code>net.forward_prefilled</code>. Function <code>net.forward</code> takes in a cell array of N-D arrays containing data of input blob(s) and outputs a cell array containing data from output blob(s). Function <code>net.forward_prefilled</code> uses existing data in input blob(s) during forward pass, takes no input and produces no output. After creating some data for input blobs like <code>data = rand(net.blobs(&#39;data&#39;).shape);</code> you can run</p>
<pre><code>res = net.forward({data});
prob = res{1};
</code></pre><p>Or</p>
<pre><code>net.blobs(&apos;data&apos;).set_data(data);
net.forward_prefilled();
prob = net.blobs(&apos;prob&apos;).get_data();
</code></pre><p>Backward is similar using <code>net.backward</code> or <code>net.backward_prefilled</code> and replacing <code>get_data</code> and <code>set_data</code> with <code>get_diff</code> and <code>set_diff</code>. After creating some gradients for output blobs like <code>prob_diff = rand(net.blobs(&#39;prob&#39;).shape);</code> you can run</p>
<pre><code>res = net.backward({prob_diff});
data_diff = res{1};
</code></pre><p>Or</p>
<pre><code>net.blobs(&apos;prob&apos;).set_diff(prob_diff);
net.backward_prefilled();
data_diff = net.blobs(&apos;data&apos;).get_diff();
</code></pre><p><strong>However, the backward computation above doesn’t get correct results, because Caffe decides that the network does not need backward computation. To get correct backward results, you need to set ‘force_backward: true’ in your network prototxt.</strong></p>
<p>After performing forward or backward pass, you can also <u>get the <strong>data or diff</strong></u> in internal blobs. For example, to extract pool5 features after forward pass:</p>
<pre><code>pool5_feat = net.blobs(&apos;pool5&apos;).get_data();
</code></pre><p>Reshape</p>
<p>Assume you want to run 1 image at a time instead of 10:</p>
<pre><code>net.blobs(&apos;data&apos;).reshape([227 227 3 1]); % reshape blob &apos;data&apos;
net.reshape();
</code></pre><p>Then the whole network is reshaped (the second command?), and now net.blobs(‘prob’).shape should be [1000 1];</p>
<h5 id="Training"><a href="#Training" class="headerlink" title="Training"></a>Training</h5><p>Assume you have created training and validation lmdbs following our ImageNET Tutorial, to create a solver and train on ILSVRC 2012 classification dataset:</p>
<pre><code>solver = caffe.Solver(&apos;./models/bvlc_reference_caffenet/solver.prototxt&apos;);
</code></pre><p>which creates solver object as</p>
<pre><code>Solver with properties:

        net: [1x1 caffe.Net]
  test_nets: [1x1 caffe.Net]
</code></pre><p>To train:</p>
<pre><code>solver.solve();
</code></pre><p>Or train for only 1000 iterations (so that you can do something to its net before training more iterations)</p>
<pre><code>solver.step(1000);
</code></pre><p>To get iteration number:</p>
<pre><code>iter = solver.iter();
</code></pre><p>To get its network:</p>
<pre><code>train_net = solver.net;
test_net = solver.test_nets(1);
</code></pre><p>To resume from a snapshot  your_snapshot.solverstate:</p>
<pre><code>solver.restore(&apos;your_snapshot.solverstate&apos;);
</code></pre><h5 id="Input-and-output"><a href="#Input-and-output" class="headerlink" title="Input and output"></a>Input and output</h5><p>caffe.io class provides basic input functions <code>load_image</code> and <code>read_mean</code>. For example, to read ILSVRC 2012 mean file (assume you have downloaded imagenet example auxiliary files by running <code>./data/ilsvrc12/get_ilsvrc_aux.sh</code>):</p>
<pre><code>mean_data = caffe.io.read_mean(&apos;./data/ilsvrc12/imagenet_mean.binaryproto&apos;);
</code></pre><p>To read Caffe’s example image and resize to [width, height] and suppose we want width = 256; height = 256;</p>
<pre><code>im_data = caffe.io.load_image(&apos;./examples/images/cat.jpg&apos;);
im_data = imresize(im_data, [width, height]); % resize using Matlab&apos;s imresize
</code></pre><p><strong>Keep in mind that width is the fastest dimension and channels are BGR, which is different from the usual way that Matlab stores an image.</strong> If you don’t want to use <code>caffe.io.load_image</code> and prefer to load an image by yourself, you can do</p>
<pre><code>im_data = imread(&apos;./examples/images/cat.jpg&apos;); % read image
im_data = im_data(:, :, [3, 2, 1]); % convert from RGB to BGR
im_data = permute(im_data, [2, 1, 3]); % permute width and height
im_data = single(im_data); % convert to single precision
</code></pre><p>Also, you may take a look at <code>caffe/matlab/demo/classification_demo.m</code> to see how to prepare input by taking crops from an image.</p>
<p>We show in <code>caffe/matlab/hdf5creation</code> how to read and write HDF5 data with Matlab. We do not provide extra functions for data output as Matlab itself is already quite powerful in output.</p>
<h5 id="Clear-nets-and-solvers"><a href="#Clear-nets-and-solvers" class="headerlink" title="Clear nets and solvers"></a>Clear nets and solvers</h5><p>Call <code>caffe.reset_all()</code> to clear all solvers and stand-alone nets you have created.</p>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><hr>
<p><a href="http://caffe.berkeleyvision.org/tutorial/interfaces.html" target="_blank" rel="noopener">http://caffe.berkeleyvision.org/tutorial/interfaces.html</a></p>
<h3 id="caffe学习与当前的任务"><a href="#caffe学习与当前的任务" class="headerlink" title="caffe学习与当前的任务"></a>caffe学习与当前的任务</h3><hr>
<p>caffe本质上仍是C++，只不过提供了很多借口，使得在不同环境下可以运行（训练和测试），</p>
<p>什么才是不同的语言呢？主要还是看网络的实现方式，如果用python编写，例如用到很多nn的函数；caffe的网络虽然在prototxt中定义，看起来像一个纯文本，但是他是要送到后方经过C++处理的。</p>
<p>对于目前的任务，我想，一个是自己fine-tuning数据公司提供的数据，看看质量如何；另一个就是等到数据发布后，选手们会提交自己的框架、算法、代码，到时候会对他们进行测试，即调用网络并计算出一定的指标。除此之外，说的稍微远一点，detection和segmentation也要看一些，到时候万一用得着呢？反正以后一定会用得着。</p>

      
    </div>
    
    
    

    
      <div>
        <div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="/img/webwxgetmsgimg.jpg" alt="John Sky wechat" style="width: 200px; max-width: 100%;"/>
    <div>scanning my wechat for further communication</div>
</div>

      </div>
    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/08/06/2018-06-05-【ML一步一脚印】生成标签文件/" rel="next" title="【ML一步一脚印】生成标签文件">
                <i class="fa fa-chevron-left"></i> 【ML一步一脚印】生成标签文件
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/08/06/2018-06-06-【ML一步一脚印】批量删除子文件夹和文件名中的空格/" rel="prev" title="【ML一步一脚印】批量删除子文件夹和文件名中的空格">
                【ML一步一脚印】批量删除子文件夹和文件名中的空格 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      
        <div id="gitment-container"></div>
      
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">John Sky</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">31</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/goldentimecoolk" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:jsktt01@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Command-Line"><span class="nav-number">1.</span> <span class="nav-text">Command Line</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Python"><span class="nav-number">2.</span> <span class="nav-text">Python</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MATLAB"><span class="nav-number">3.</span> <span class="nav-text">MATLAB</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Build-MatCaffe"><span class="nav-number">3.1.</span> <span class="nav-text">Build MatCaffe</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Use-MatCaffe"><span class="nav-number">3.2.</span> <span class="nav-text">Use MatCaffe</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Set-mode-and-device"><span class="nav-number">3.2.1.</span> <span class="nav-text">Set mode and device</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Create-a-network-and-access-its-layers-and-blobs"><span class="nav-number">3.2.2.</span> <span class="nav-text">Create a network and access its layers and blobs</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Forward-and-backward"><span class="nav-number">3.2.3.</span> <span class="nav-text">Forward and backward</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Training"><span class="nav-number">3.2.4.</span> <span class="nav-text">Training</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Input-and-output"><span class="nav-number">3.2.5.</span> <span class="nav-text">Input and output</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Clear-nets-and-solvers"><span class="nav-number">3.2.6.</span> <span class="nav-text">Clear nets and solvers</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Reference"><span class="nav-number">4.</span> <span class="nav-text">Reference</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#caffe学习与当前的任务"><span class="nav-number">5.</span> <span class="nav-text">caffe学习与当前的任务</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Sky</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  







<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script>
    
<!-- END LOCAL -->

    

    
      <script type="text/javascript">
      function renderGitment(){
        var gitment = new Gitmint({
            id: decodeURI(window.location.pathname), 
            owner: 'goldentimecoolk',
            repo: 'gitment-comments',
            
            lang: "" || navigator.language || navigator.systemLanguage || navigator.userLanguage,
            
            oauth: {
            
            
                client_secret: 'a221e3a05eedb33f9a4dd3f49da9bc58ff692a70',
            
                client_id: '920e0d6623cd15e1ed42'
            }});
        gitment.render('gitment-container');
      }

      
      renderGitment();
      
      </script>
    







  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
